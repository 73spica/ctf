import requests
from base64 import b64encode
from bs4 import BeautifulSoup

all_cipher = "c9cff93cd456fa3dfb2d437585d50bee4de2fdf0a93da5f4dc1839c7f26cc57a82bebef31875f2ba8b8c8451077954eadee6af1e8137acee53f0e90b4776cad7fabced81d704fbead11cc48aa57de7f039b956cbe917d19a88e13a719acc8c7f5669d29113db1081a5a42a6096555bdd43ebaf308733117c4fcfebdcbc15eb2218c8602a446f764e927f4bbafbe8292f0e88560f426c6030d1510c953d3c37b6e11f9826558217831a22ee44b7699c6d7f5dcdf755ef1e8c64322ae69441dfeed2e804bedf1ca09d98f51c491f4a4f9ba2660a7351914c68af36371d013da9a971886b7bfbf0c1c45cfafe4a9a8e9db87ba8e4b4319e9c2b117baffc17dfce9b8d54de9f2d990fcc51ff5421184a2fb9697cec02d5bf1968971c8a5e7b6967cdfa360c4602fa9ed96e352014d21f8f08672f0df44fc5b8adcff7ccd4f529f242305af7a0ee84ab987cbca04ab1d8b01f277ab63f36753dbd7afcce11e76d659bec83055f66b576b91128b56467c5327a56dee9f6bed9d1d09800b2a6ff4e72693b1c1db6123523a628a668fdc11f25ffb65162bf6d36b3a721c04bcf24b6966e9f1bdd58fc5fc6714eaf0d3866c39400bac892e8c50242792493ab6b6f4be40a985d18a6b1758684655b134f2e62d778cfb9b89c9c1d22fcfd94d3c0ec12cc3304e26a18782fd5967fbfc91a5e44e33facf5d658dca577dbd3408e4f70e4b642dcbd591a753a8dd5d24358e38d72aee95ba84381866e6e663d479bbf42346366a4849d942104282dd38850ad63ee47cdbeb404d5b8b90183d09ef50f6065f6f36bd1d64a61c4323a192377d5be61ab378c472602f6dbc2c6554c061e4564c0d1afbb758b7befa694eefb22dd878845cd37fbd224aa254909faf75b7ae94e381bbaaf539e4ccb65cc4cfd605024b71de88409631212817120df693ed0fbfaf897293a656eaf4227bdd677bcdae6f2d4b4d31184f6556bac78673bd61a60490747478dc6601ca50fb6c15ccecec313db016114338328636906ba516b586d8eddaccb0020493b7a9052196aa55b5c809d7c4dfc5a07ea7a75fd68a51bf11fd68133d8e190ef21a6b537831a73a22b3c6b8a51bb5cdfb07c45246388e2c066a7cbce374c9e5d028a94aea3d28055dedb2097c76161e9dc410c9cc179a3b45f65b5e21159d516ad541956305e9212d7a538918920a29477e436c10ca174f02c0760ceb6d75afb417e987dd8433aeae6552974fa201295371114b307458da761282c5e66adf9298972bcc9cead75d3aa6c6c5bb631b3a0ddcedfb6ff859ea9d24c79e2d7a43044cf4c71a8087e9e75645696aa2d7ab58806dca7bb220dea493fee4a132a3870fb0c5ce4c428f1ebc67fd31221f29d95bee4904edb03ae03c58658c444733ed125ae44b8570f38d133db1696a2ef6be945f0a50f1a8ce058c49c46d9e39b0835f1db6f721212ed8789a064a4d397c5ad467bb40e1f7de059741c4706a7f1343abb4c5acedd7490ca507b57b5e7446d7153b779809ca051dd6ae5daa01f461c5d49bb908de64c967f9e4f6a232b1f819e7aa4eb480ba9e3660aac564b288c45579404238ce1e2df567e37e8f09acb05576a3283402720c01b199b3544c95f1463f964990d29bc2deba42d67df740ff6f906b71399aa198e2a33ceaab5d29febbb34761a3a7afaa595a9fdabb3a8d9c0c2a9c853c132c886469c6aab540f5e812a039bed4c03935258332601d566a8a5fe733eb07f3010c9bc33c3e6918f700935389d3ee4bd4df79d16d5ced251b8df86b9154b325e1dbb71841c99c106d33a76371255cb16e85438489e0f7b090e96ba3debd840fbe2361a6a4c096f6ad8c9b00c4f59770fb62c823fd6b8f447abc0edb6dc6a1e5d61f4053c64c9ff6862b712867e2215db8eba78dfd3069f9aef47c1e57b1d974e7c0a2c1a9d6a0b17e872a53a8c7e97f65de6f47935be001a603dbab5cef04d8dc6efc478848838772bf76e20468342609ba7d1fea3aa5dadb35795944527ac9a3d16de201236f6b1b7ad78c45545a879f6614a6952d4b20cc4d4146b65811b165fcf74232de8287c1ea0fe748c0bbaddca671db2a31ed54f1658a6ed1fa4d2ae7661867dc7fbe131b5f16becda820e1c6e9c5830ffc5c5a06ab74b515d691ae24d887ea2d2c748a0040809eff4ee8614a68c292521d15a2975983cc9006c0a523d5858c74560dcad61512258680f86b62eb8012e83141fa98143e827f3aa856b01d901315844bef50d94c172032a1dc4907742deceefb7394c8db1e29c209ce06b446e43eeb4d7ecb377838a9fa206307949c800a5ad03bf997c834068184ee954684afb4167d14d58244d717190e17622a9b03cf25be752f3fc8f43fb87461ef65f78c9ea981a03cd297941e56aa529fe0812e24470256ffcc825dc6149fde1c1f293f61e39db1580c6b6a70de94e1c99036248ca213249ff790acac34d9a85e494c3e51e8297e1cb7800d4f69beb897d832331741789ef928f048583f28f9427c6ad7eabf5bed77531a0289949e34a058306899a0899c1ea4cec3fb642d0f81d49ea0fa059b38fe9364fcbaa0a50c19ce089c056eeea410f421ae681166f2b5b986e94692996bec264f88e17bfaacd69e9f5d9fdc8a206d2a17511d63cb9d9125f65f0367fdc2bb497cc352508cd24a045333cccac51bcfbe7b35252158d0811c2391280742ee76e29fa7dbe094591cc23a932491eeb440063333ae067fef801e9988781ad605daa9c454d632f1cdb614e79400da71ba6a576ac92baa26adf0f4210295aaf7999583fc297c55ad0714034437f9047cac55ff011feab48d2f5fee605fb5e645c6bd2b977ef57b792d92790ddebdecd534d45ead2e7d13f9da1ff1634052a08f9f6362a859fbcfd72749d769872bc3e95016b624d1914be27f8b2cfb46db16e180c3e722f7913a46910ea12c951959917ba4d2550b8c2740d0bd887e576360de05d779497fa03fe212a5086d3edd6846e5dbbc7c45d1c78188f86552374c58cb2ca8c0d84185643f7a5766810044056be630fbaa7aa322ad31536e82863a88bbc15464ccb33c11c39318adeac199b46b5de657173cb4d42b4cd56a082ba8b89eb4e51b8680739a18975beb79becf10fa49c366aba78a057d21faac5e4faaea4127f6a18ac679ad870258fba87ef1defb56f130d406ad2ca5bc5278f3fecd2035c25e1d0dbf677379cdbc9f796ab6f6748cbfee0089ae8235e0383025e42e2bbc16ec20463458be5e341b5257b1d23f51387f44a4a1eedced19daf07f571507126f5c77b858fa874fa2210ad174e547a99a6d92e13a15d0b96103469095a5adc929d3314969a47b297d5a70dae3f939d6b41b6dbcb0d0996a16533fbed3ce877781acd350979f2320299eef07c33056953e2f9fb8af9fbeaadbf3f957cdfbd997a1f06aac1d438f3b7bac3cf2a45c9d581b630db4e6fe07593978bcda5dc7eb9a76f1b6f61cdf9bbc7dc85b35ce0327b3339b7d57702f60be1e2bd342922491171991ef4d5909e4c27a1144e0e486e861043a3629255369cfe55f38470e1e7640f51dd182e641fdf8144e14e375ebe98f95c96fb7c8dbfee7b2569219a2c69c5940dc067a7a278cbc2e870b4bd3d038d8fb9f84c9dca0a7448d8cb77764b532987faa0f745702d3259e311e9838821119ecece497996272f105e921963d74371ae33c41b36c3193bfc3ae03f393abc245fd0776c1fa6807134d74784d031b17cc27ed848bc5c75b9d67d6c587bcc78a94d627a6edb24db9c2c76b2f68234eba959a44598439641f71de8328ad00be95611e4260eb62d188abaee389da1dbfed49c2c1f577d8146fb0711c7772e00aa7019f1141fbe1dd084b8cf6a9e4d70ef15267828699f94fc6874ddf6563aceb30c274c452e7f06e71b9ae0b99b4bf9465cb8652d32438886d789fdf0173dc4dc156be828e7c285bae3c65fd656f9f8212f1730a67e3fee0151f702b95567456f16a9dfed152fc401e2ec7b0bd2c72dbe6937f4d1aeff8646246b31e90cb4a1a2469468f661903b3bcf9de57de44447b343c2cac64cc82acbef58215b8eeb6267da1d712d1bb9f16bd5a657fb081c7cfa506872f403eb0b2c73dcdd00360e5dc12bfea68c2f55623dfaac9533394b2dd742f8484c17be41ae23d57d18f90c13646edbf0ba2bb0ecd67751d8dc2287327e614a82a92837751586729728efab078a74af73f02d170b1e6da4913ab41ca4794120b33e4fefec3613176d254dbf852570bf2423fb8daf2630787ad3c2a7152351126a914ed7f3e66aed8a71485721b6132fe76efa80656700623362b9e7d38843df030419594f973ed6e781c3e02c07f842a5b6e5c947f87b8e2e4e2dac4b5e4aab5472a04afa1c99dacd9fac2fbd72d024e192485d04f2bda1b90804a2c2e774e21efdcb9f2e957450c067f0d17be1728466e3a1104199685fa93390c73466e0eaae63e45627aa5aa0acc9ab899160e9f314740c8cf122a571c8e21a658f9070b85273a3c0b83ad65a4b611a7b2c5a20c5eae81db0830ef65a8379e93e3869adb546a337142d82e08b22b08e43009b20992522ee85ef6e0e448701067b22acc1f43514fe2a1abcbce7e91c5a6e4221120a1c8db1c4cfd218e8a91bf310a2c60adabbe5eb97b3d953bc1e495846e42b4d5f04a28b59a4e527b71249e28ba51f4407d729f65b25d0141c0eed120e9c877b0b5c68f1274169bbc24ab3eade6b27c90e26c6b8dcf2a427d3b50f5d708c6e96cc3d8a7f046880c431c7db8572f3244ee36bc4e75f577847ecf1101ae7196c7f54a76c43936973f7700ae58b1881b712dd1787b3f6010f98f6fdb853bd823b60531fb132b5f718627d4070eb023d6fcbe388ede5c6a59e4fe63d651d93ed898b0e714b9945b50851a9e3c073f58ba16649d7d0943b60ba084b80eda53644be82a9d22366c06bd4e82f59f44ff72d3133425364e7ebbf6eccb35c43a358e391a2f7044bb3a4fe33e4a51b188b454f1a24a59287a8d81a2bab15ad95bb718b43197453d54c46cd56b9071c5b3e7cff345cd460ca62c02164e02d5b1bc0e54c017294e5efa74e32f00ca62344a01af751d0fbe31108249242abf7a97538ce5bac7d559f579a818075625bb2644f7cafe61b876bde84e6ce504adb3916415e96d089328a46400bc06c7211902a6a60022f93b1e90069f7da9df450167f4d6365891f6f9b571648d530fd6b50fa8556d7e629d566a3fd56d8360f7ecb2e43b4aa47b467d46cd9950f64f6cdd6ab2c221f64e8ca2f32f46eaf39efb0efa7e328b0bfa9285495549c15d39c20834aab78f56af5fea6036b9fdc3e2747694c963e5104098132671d09820b363543db560f918dbf7264f67f4d5a3a26e92eff25b074324b81ce863bb25507d672eb5d4400129c235deed5dfd9baa689768940c61b9262960c91e9e1463e65ae194c6024d96e7fd094060be21905bcc7afee65cf7f1f6a39690d022b2b6d3ac80a4fc90b140d3848ea49f4339f99eb8f0644033afa9200c35f2a143ef5294709c110f57f4eb99dbbb5e67c5373843c383a9dfd2ce33ce452d82f0f0a8b7e34464be7bf0a2fa2c428da5316d49c9da52c244bc62d635e4b0acfdee886a168394e8e4863d3656ce56f0cf917cdd67cb920205eaeb1490d66cc0d4f885d391611f30b779f41323a2c1fd0d951efd7cec916daf23713376034dd74f9a8fc086d96d929460291bead2d4f7d0c518fedf0a962e7b7a15e33a8a42fa6f7c8d989e40a64f5068e79992d99d32a88e5b3859a07f08302f0427cadba85f933a146512236e37560c86360948eef0108a32368467a57f23edd90572a1a3d077c247c7269e5d5ad9c907a9b6ebd7d48544852192d11f4cdcc69e72ecaa4951cfc0531601a68523ff6d067ad65fc8f64c316abe77fc9aa8bac1ce0eecd80b81070c171cfb7b5f9b022e76b507eed6be2960a80727768f5924f128999c378ac7f79095c15ec6aa08a5848115af31e545eb888b1ea3aba60eefe7a2196c03d99a154b0026512f49713f16cc709e86ceb3e253b6400fddd146b13c822576b25a3a48e7e04c27190e016186fe489cebdb050426994df0de59584214f181d0024dc089183bd1daf7b4a498a38842e14e45dce5c581885066cb21de9a0bf0a3722892e35fe2ee425b707369c98a310f0593845536853294f3bf4563b9d273057401fe4e02b0107033916c1a0a0b11be74ca57f11b7595297ca5aa78cd9ed94d2f62396a1b03c793bcadbecaf9b49594aac8bc7290e87417ec470202791542f4fe60d2c6583ecade5c02b0283787ab9f5442b26a11406e09e3a404785b74efcd6233f71362f98d88715e944e983e91091386838f89a01bd9ba7272e857284e3c491784947b5760159332d409899095a4629935e75ad8194a69ade73766427e702e570aea0b8799dcba39bb6e16ca5262b67bf2d901c8675ba3a3aea48a3001f91fe5f4814c44dcacacc7985e60f9619f9e29d0f37a600462a8f487459eb1431fe62c4498343c5d669e7475ecf37d31042232ad33421d957429d80ecff37c961de9be05c0a53e5b16c0172f147c7c7beb425b38ffaeaaa0870fbcda1a07787bf8a05ce0f47abaee3cbd60d83e08f8803972169839c"

def get_dec(url,i,cookie_f=0,pre_cipher = "",block_size = 32):
    global all_cipher
    target_cipher = all_cipher[i:i+block_size]
    values = {
        'cipher' : target_cipher
    }
    if cookie_f == 1:
        iv = b64encode(pre_cipher.decode("hex"))
        # print iv
        cookies = dict(iv=iv)
        r = requests.post(url,data=values,cookies=cookies)
    else:
        r = requests.post(url,data=values)
    # print r.text
    pre_cipher = target_cipher
    soup = BeautifulSoup(r.text,"lxml")
    ko = soup.find("div",id="result")
    plain = ko.string
    return plain,pre_cipher

def main():
    all_plain = ""
    block_size = 32
    url = u"http://127.0.0.1:12345/cgi-bin/problem.py"
    # url = u"http://ec2-52-193-204-166.ap-northeast-1.compute.amazonaws.com:12345/cgi-bin/problem.py"
    plain,pre_cipher = get_dec(url,0)
    print plain
    all_plain += plain
    i=block_size
    while True:
        if i>=len(all_cipher)-1:
            break
        plain,pre_cipher = get_dec(url,i,1,pre_cipher)
        print plain
        all_plain += plain
        i+=32

    print all_plain

if __name__ == '__main__':
    main()
